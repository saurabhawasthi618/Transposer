<!DOCTYPE html>
<html>
  <head>
    <title>Chord Transposer</title>
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.8/dist/css/bootstrap.min.css"
      rel="stylesheet"
      integrity="sha384-sRIl4kxILFvY47J16cr9ZwB07vP4J8+LH7qKQnuqkuIAvNWLzeN8tE5YBujZqJLB"
      crossorigin="anonymous"
    />

    <link
      rel="shortcut icon"
      href="{{ url_for('static', filename='assets/music.svg') }}"
      type="image/svg+xml"
    />

    <style>
      body {
        font-family: Arial;
        display: flex;
        max-width: 1400px;
        margin: 40px auto;
      }
      .sidebar {
        width: 250px;
        border-right: 1px solid #ccc;
        padding-right: 20px;
      }
      .main {
        flex: 1;
        padding-left: 20px;
      }
      textarea {
        width: 100%;
        height: 150rem;
        font-family: monospace;
        font-size: 16px;
        padding: 10px;
        border: 1px solid #ccc;
        resize: none;
        white-space: pre-wrap;
      }
      .buttons {
        margin: 20px 0;
      }
      .btn {
        padding: 10px 20px;
        font-size: 16px;
        margin-right: 10px;
        cursor: pointer;
      }
      h3 {
        margin-bottom: 10px;
      }
      .capo-box {
        margin-bottom: 20px;
        font-size: 18px;
        display: flex;
        align-items: center;
        gap: 10px;
      }
      input[type="number"] {
        width: 60px;
        padding: 5px;
        font-size: 16px;
      }
      input[name="name"] {
        padding: 5px;
        font-size: 16px;
        width: 200px;
      }
      .song-link {
        display: flex;
        justify-content: space-between;
        align-items: center;
        padding: 5px;
        margin-bottom: 5px;
        border: 1px solid #ddd;
        text-decoration: none;
        color: black;
      }
      .song-link:hover {
        background-color: #f0f0f0;
      }
      .delete-btn {
        background-color: red;
        color: white;
        border: none;
        padding: 2px 6px;
        cursor: pointer;
        font-size: 12px;
      }

      .active-song {
        background-color: #d0ebff;
      }

      .filter-box {
        margin-bottom: 15px;
        display: flex;
        flex-direction: column;
        gap: 8px;
      }

      .filter-box label {
        font-size: 14px;
        font-weight: 500;
      }

      .filter-box select {
        padding: 5px;
        font-size: 14px;
        border: 1px solid #ccc;
        border-radius: 4px;
      }

      .song-link.hidden {
        display: none;
      }
    </style>
  </head>
  <body>
    <div class="sidebar w-25">
      <h3>Saved Songs</h3>

      <!-- New Song Button -->
      <form method="POST" style="margin-bottom: 20px">
        <button class="btn btn-primary" type="submit" name="action" value="new">
          + New Song
        </button>
      </form>

      <form method="POST">
        {% for id, song_name, content, saved_capo in songs %}
        <div
          class="song-link{% if current_song_id and current_song_id|int == id %} active-song{% endif %}"
          data-capo="{{ saved_capo }}"
        >
          <a
            href="{{ url_for('index', song_id=id) }}"
            style="color: black; text-decoration: none; padding-left: 1rem"
          >
            {{ song_name if song_name else content[:30]|replace('\n',' ') }}{%
            if content|length > 30 %}...{% endif %}
          </a>
          <button
            class="btn delete-btn"
            type="submit"
            name="action"
            value="delete_{{ id }}"
            style="cursor: pointer"
          >
            X
          </button>
        </div>
        {% else %}
        <p>No saved songs</p>
        {% endfor %}
      </form>
    </div>

    <div class="main">
      <h2>Chord Transposer</h2>

      <form method="POST">
        <div class="d-flex justify-content-between">
          <div class="capo-box">
            <label>
              Name:
              <input
                type="text"
                name="name"
                value="{{ name }}"
                placeholder="Song Name"
              />
            </label>
            <label>
              Capo Position:
              <input
                type="number"
                name="capo"
                min="0"
                max="12"
                value="{{ capo }}"
              />
            </label>
            <button
              class="btn btn-success"
              type="submit"
              name="action"
              value="save"
            >
              Save
            </button>
          </div>

          <!-- Capo Filter -->
          <style>
            select,
            option {
              height: 2.5rem;
            }
          </style>
          <div class="w-25 d-flex align-items-center">
            <div class="filter-box w-100">
              <!-- <label for="capo-filter">Filter by Capo:</label> -->
              <select id="capo-filter">
                <option value="">All Songs</option>
                <option value="0">Capo 0</option>
                <option value="1">Capo 1</option>
                <option value="2">Capo 2</option>
                <option value="3">Capo 3</option>
                <option value="4">Capo 4</option>
                <option value="5">Capo 5</option>
                <option value="6">Capo 6</option>
                <option value="7">Capo 7</option>
                <option value="8">Capo 8</option>
                <option value="9">Capo 9</option>
                <option value="10">Capo 10</option>
                <option value="11">Capo 11</option>
                <option value="12">Capo 12</option>
              </select>
            </div>
          </div>
        </div>

        <script>
          // Filter songs by capo position
          const capoFilter = document.getElementById("capo-filter");
          capoFilter.addEventListener("change", function () {
            const selectedCapo = this.value;
            const songLinks = document.querySelectorAll(".song-link");

            songLinks.forEach((link) => {
              const capoValue = link.getAttribute("data-capo");
              if (selectedCapo === "" || capoValue === selectedCapo) {
                link.classList.remove("hidden");
              } else {
                link.classList.add("hidden");
              }
            });
          });
        </script>

        <div class="buttons">
          <button
            class="btn btn-primary"
            type="submit"
            name="action"
            value="up"
          >
            Transpose Up
          </button>
          <button
            class="btn btn-primary"
            type="submit"
            name="action"
            value="down"
          >
            Transpose Down
          </button>
        </div>

        <input type="hidden" name="output_text" value="{{ output_text }}" />

        <div>
          <h3>Input</h3>
          <textarea name="songtext">{{ input_text }}</textarea>
        </div>
      </form>
    </div>
    <script
      src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.8/dist/js/bootstrap.bundle.min.js"
      integrity="sha384-FKyoEForCGlyvwx9Hj09JcYn3nv7wiPVlz7YYwJrWVcXK/BmnVDxM+D2scQbITxI"
      crossorigin="anonymous"
    ></script>
  </body>
</html>
